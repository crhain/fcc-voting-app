<% include ../partials/header %> 

<div class="heading-secondary">
    <h2><%= poll.name %>, by <%= poll.author.name %></h2>
</div>
<div class="heading-tertiary">
    <h3><%= poll.question %> </h3>
</div>

<div class="row-g">
    <div class="col-1-of-2">
        <div class="poll">
            <form class="delete-form" action="/polls/<%=poll._id%>/vote/?_method=PUT" method="POST">
                <ul>
                        <% poll.pollOptions.forEach(function(option, index){ %> 
                            <li class="poll__option">
                                <% if(index === 0){ %>
                                    <input class="poll__option-checkbox"type="radio" id="pollr-<%= index %>" name="option" value="<%=option._id%>" style="display: none" checked>
                                <% } else { %>
                                    <input class="poll__option-checkbox"type="radio" id="pollr-<%= index %>" name="option" value="<%=option._id%>" style="display: none">
                                <% } %>    
                                <label for="pollr-<%= index %>">
                                    <span class="poll__option-name"><%=option.option%></span>
                                    <span class="poll__option-count"><%=option.count%></span>
                                </label>
                            </li>
                        <% }); %>
                            <li class="poll__option">
                                <input class="poll__option-checkbox" type="radio" id="pollr-new" name="option" value="new" style="display: none">
                                <label for="pollr-new">
                                    <span class="poll__option-new">New</span>                                    
                                </label>
                            </li>                                           
                </ul>
                <input type="text" id="poll-input-new" class="poll__input-new" name="newOption">
                <button id="poll-vote-btn" class="btn btn-danger">Vote!</button>            
            </form>
        </div>        
        <!-- this button will open a delete modal confirmation and the modal confirm button will actually fire the delete -->
        
        <% if(currentUser && poll.author.id.equals(currentUser._id)){ %>
        <form class="delete-form" action="/polls/<%=poll._id%>/?_method=DELETE" method="POST">            
            <button class="btn btn-danger">Delete This Poll!</button>            
        </form>
        <% } %>

        <!-- <p>My current user is <%= currentUser %></p> -->

    </div>
    <div class="col-1-of-2">        
        <div class="chart">
            <div class="chart__container" >
                <canvas id="myChart" width="300" height="300"></canvas>                
            </div>
        </div>
                        
    </div>
</div>

 <!-- <div id="poll-info-container" class="hidden">
    <div id="poll-id"><%= poll._id %></div>
    <div id="poll-current-voter"><%= currentUser %></div>
 </div>    -->
 
 <script type="text/javascript" src="/src/javascripts/poll-chart.js"></script>
 <script>
    var myChart = chartjs.draw();
    var voteBtn = document.getElementById("poll-vote-btn");
    voteBtn.addEventListener('click', function(e){
        var pollNewRadio = document.getElementById("pollr-new");
        var pollNewInput = document.getElementById("poll-input-new");
        
        if(pollNewRadio.checked && !pollNewInput.value){
            e.preventDefault();
        }
        
    });
 </script>
 <!-- <script type="text/javascript" src="/src/javascripts/poll-ui.js"></script>      -->

        
<% include ../partials/footer %>