"use strict";!function(e){function t(e){console.log("I am updating the page with new data!");for(var t=document.getElementById("poll-results-list"),n="",o="",l=0;l<e.pollOptions.length;l++)n+='<li class="option"><span class="option-name">',n+=e.pollOptions[l].option+"</span> : ",n+='<span class="option-count">'+e.pollOptions[l].count+"</span></li>",o+='<option class="poll-option" value='+l+">",o+=e.pollOptions[l].option+"</option>";o+='<option value="-1">Add new option</option>',t.innerHTML=n,i.innerHTML=o,chartjs.update(s)}var n=document.getElementById("poll-vote-btn"),o=(document.getElementById("new-option-btn"),document.getElementById("delete-poll-btn")),l=document.getElementById("share-twitter-btn"),i=document.getElementById("poll-options"),p=document.getElementById("poll-id").textContent,s=chartjs.draw();n.addEventListener("click",function(e){var n,o,l=i.value,s=i.options,d=i.selectedOptions[0].textContent,c=Array.prototype.slice.call(s),a=c.length,r={voter:document.getElementById("poll-current-voter").textContent,id:l,option:d,new:!1};if(e.preventDefault(),"-1"===l){if(r.option=document.getElementById("new-option").value,""===r.option)return void console.log("please input a new option before voting!");if(c.find(function(e){return e.textContent===r.option}))return void console.log("Option already exists!");r.id=a-1,r.new=!0}(n=new Headers).set("Content-Type","application/json"),o={method:"POST",headers:n,credentials:"include",body:JSON.stringify(r)},fetch("/polls/user/vote/"+p,o).then(function(e){return e.json()}).then(function(e){e.voted?console.log("you cannot vote more than once"):t(e)}),console.log("voting for "+r.option)}),o&&o.addEventListener("click",function(e){e.preventDefault();var t={method:"DELETE",headers:new Headers,credentials:"include"};fetch("/polls/user/delete/"+p,t),console.log("deleting current poll: "+p),window.location.href="/polls/user/"}),l&&l.addEventListener("click",function(e){e.preventDefault(),console.log("sharing on twitter...");var t="Check out my new poll at: "+window.location,n="https://twitter.com/intent/tweet?text="+encodeURIComponent(t)+"&hashtags=poll";window.open(n,"Share")})}("undefined"!=typeof self&&self);